<h2 align='center'>FS Browser. –û—Ç –±–µ—Å—Å–æ–Ω–Ω—ã—Ö –Ω–æ—á–µ–π –¥–æ –ø—è—Ç–∏ –∫—Ä—É–∂–µ–∫ –∫–æ—Ñ–µ</h2>

<p align='center'>
<img src='https://forthebadge.com/images/badges/built-with-love.svg' />
<img src='https://forthebadge.com/images/badges/powered-by-energy-drinks.svg' />
<img src='https://forthebadge.com/images/badges/powered-by-coffee.svg' />
</p>

<br><br>

<hr/>

<p align='center'>
<img src='https://img.shields.io/badge/Developed%20by-Arthur%20A.%20Kupriyanov-blue?style=for-the-badge' />
</p>



### –° —á–µ–≥–æ –Ω–∞—á–∞—Ç—å?

–õ—é–±–∞—è —Ä–∞–±–æ—Ç–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –∫–∞–∫–æ–≥–æ-—Ç–æ –ø–ª–∞–Ω–∞ (—Ö–æ—Ç—å –∫–∞–∫–æ–≥–æ-–Ω–∏–±—É–¥—å). –û–Ω –±–∞–∑–∏—Ä—É–µ—Ç—Å—è –ª–∏–±–æ –Ω–∞ –∑–∞–¥–∞—á–µ, –ª–∏–±–æ –≤ –∫–∞–∫–æ–π-–ª–∏–±–æ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏.

–í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ, —É –Ω–∞—Å –±—ã–ª–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ñ–∞–π–ª–æ–≤—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –≤ –≤–∏–¥–µ –∫–ª–∏–µ–Ω—Ç-—Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

–ò–∑ –Ω–∏—Ö —è –±—ã –≤—ã–¥–µ–ª–∏–ª –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—É–Ω–∫—Ç–æ–≤, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ –Ω–∞–¥–æ –±—ã–ª–æ –ø–æ–±–æ—Ä–æ—Ç—å—Å—è:

* –°–∞–º –∫–ª–∏–µ–Ω—Ç-—Å–µ—Ä–≤–µ—Ä–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
* –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
* –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
* –°–∫–∞—á–∏–≤–∞–Ω–∏–µ\–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞



### –ö–ª–∏–µ–Ω—Ç-—Å–µ—Ä–≤–µ—Ä–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

–í —Å–∞–º–æ–º –∫–ª–∏–µ–Ω—Ç-—Å–µ—Ä–≤–µ—Ä–Ω–æ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –Ω–∏—á–µ–≥–æ —Å–ª–æ–∂–Ω–æ–≥–æ –ø—Ä–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–µ –±—ã–ª–æ, —Ç–∞–∫ –∫–∞–∫ "—É–≤–∞–∂–∞–µ–º—ã–π" –¥–∏–Ω–æ–∑–∞–≤—Ä (—Å–∏) –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–ª –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–µ –º–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–æ–∫–µ—Ç–∞–º–∏. –î–∞ –∏ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Ä–∞–∑ –º—ã –∏—Ö –ø–∏—Å–∞–ª–∏ (–ø–∏—Å–∞–ª –Ω–∞ —Å–∏ http-server, –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥: https://github.com/AppLoidx/c-http-server)

–ü–æ—ç—Ç–æ–º—É —è –Ω–µ —Ö–æ—á—É —Å–∏–ª—å–Ω–æ –Ω–∞ —ç—Ç–æ–º –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è, –Ω–æ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∫–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã –≤—Å–µ-—Ç–∞–∫–∏ —Ä–∞—Å—Å–º–æ—Ç—Ä—é

#### Workflow

–û—Å–Ω–æ–≤–Ω—ã–º –º–µ—Ç–æ–¥–æ–º –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ —è–≤–ª—è–µ—Ç—Å—è –º–µ—Ç–æ–¥ start_server

```c
int run_server(unsigned int port, char *path);
```

–í –Ω–µ–º –∂–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∏–Ω–∏—Ü–∏–∞—Ü–∏—è —Å–æ–∫–µ—Ç–∞ –∏ –µ–≥–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:

```c
int socket_desc = socket(AF_INET, SOCK_STREAM, 0);
if (socket_desc == -1) {
    perror("Can't create socket, dude. Sorry :(");
    exit(1);
}

server_addr.sin_family = AF_INET;
server_addr.sin_addr.s_addr = INADDR_ANY;
server_addr.sin_port = htons(port);

int opt = 1;
if (setsockopt(socket_desc, SOL_SOCKET, SO_REUSEADDR, &opt, sizeof(opt)) == -1) perror("Error while calling setsockopt");

if (bind(socket_desc, (struct sockaddr *) &server_addr, sizeof(server_addr)) < 0) {
    perror("Can't bind socket");
    exit(1);
}

listen(socket_desc, 3);
```



–ü—Ä–æ–ø—É—Å—Ç–∏–º –≤—Å–µ —ç—Ç–æ —Å–∫—É—á–Ω–æ–µ –∏ –ø–æ—Å–º–æ—Ç—Ä–∏–º –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã:

* –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Ç—Ä–µ–¥–∞, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

  ```c
  pthread_t dir_state_thread;
  pthread_create(&dir_state_thread, NULL, on_dir_change, NULL);
  ```

* –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è, –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤

  ```c
  pthread_t sniffer_thread;
  pthread_create(&sniffer_thread, NULL, connection_handler, (void *) (new_sock));
  ```

* –•—Ä–∞–Ω–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö —Å–æ–∫–µ—Ç–æ–≤ –≤ –≤–∏–¥–µ —Å–≤—è–∑–∞–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ (–Ω—É–∂–Ω–∞ –¥–ª—è –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏)

  ```c
  sockets = slist_append(sockets, client_sock);
  ```

  

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

–≠—Ç–æ —è–≤–ª—è–ª–æ—Å—å –¥–æ–≤–æ–ª—å–Ω–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–π –∑–∞–¥–∞—á–µ–π, –∫–æ—Ç–æ—Ä–∞—è –±—ã–ª–∞ —Ä–µ—à–µ–Ω–∞ —Å –ø–æ–º–æ—â—å—é `<sys/inotify>`



–í–æ—Ç –ø—Ä–∏–º–µ—Ä –∫–æ–¥–∞ —Å inotify:

```c
#include <sys/inotify.h>

wd = inotify_add_watch(fd, argv[1], IN_CREATE | IN_MODIFY | IN_DELETE); 

if (wd == -1)
{
    printf("–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä %s\n",argv[1]);
}
else
{
    printf("–°–º–æ—Ç—Ä–∏–º –∑–∞ %s\n",argv[1]);
}

/* do it forever*/
while(1)
{
    i = 0;
    length = read( fd, buffer, BUF_LEN );  

    if ( length < 0 ) {
        perror( "read" );
    }  

    while ( i < length ) {
        struct inotify_event *event = ( struct inotify_event * ) &buffer[ i ];
        if ( event->len ) {
            if ( event->mask & IN_CREATE) {
                if (event->mask & IN_ISDIR)
                    printf( "–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è %s –±—ã–ª–∞ —Å–æ–∑–¥–∞–Ω–∞.\n", event->name );       
                else
                    printf( "–§–∞–π–ª %s –±—ã–ª —Å–æ–∑–¥–∞–Ω, WD %d\n", event->name, event->wd );       
            }

            if ( event->mask & IN_MODIFY) {
                if (event->mask & IN_ISDIR)
                    printf( "–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è %s –±—ã–ª–∞ –∏–∑–º–µ–Ω–µ–Ω–∞.\n", event->name );       
                else
                    printf( "–§–∞–π–ª %s –±—ã–ª –∏–∑–º–µ–Ω–µ–Ω, WD %d\n", event->name, event->wd );       
            }

            if ( event->mask & IN_DELETE) {
                if (event->mask & IN_ISDIR)
                    printf( "–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è %s –±—ã–ª–∞ —É–¥–∞–ª–µ–Ω–∞.\n", event->name );       
                else
                    printf( "–§–∞–π–ª %s –±—ã–ª —É–¥–∞–ª–µ–Ω, WD %d\n", event->name, event->wd );       
            }  

            i += EVENT_SIZE + event->len;
        }
    }
}

```



–ü—Ä–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤—ã–≥–ª—è–¥–∏—Ç —ç—Ç–æ —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

```c
void *on_dir_change(void *socket_desc) {
    int length, i = 0, wd;
    int fd;
    char buffer[BUF_LEN];

    char *working_dir = malloc(255 * sizeof(char));
    getwd(working_dir);


    /* Initialize Inotify*/
    fd = inotify_init();
    if ( fd < 0 ) {
    perror( "Couldn't initialize inotify");
    }

    /* add watch to starting directory */
    wd = inotify_add_watch(fd, working_dir, IN_CREATE | IN_DELETE); 

    if (wd == -1)
    {
        printf("Couldn't add watch to %s\n", working_dir);
    }
    else
    {
        printf("Watching:: %s\n", working_dir);
    }

    while(1)
    {
        i = 0;
        length = read( fd, buffer, BUF_LEN );  

        if ( length < 0 ) {
        perror( "read" );
        }  

        while ( i < length ) {
        struct inotify_event *event = ( struct inotify_event * ) &buffer[ i ];
        if ( event->len ) {
            if ( event->mask & IN_CREATE) {
                slist_observer(sockets, send_notification);      
            }
            if ( event->mask & IN_DELETE) {
                slist_observer(sockets, send_notification);     
            }  
            i += EVENT_SIZE + event->len;
        }
        }
    }
    /* Clean up*/
    inotify_rm_watch( fd, wd );
    close( fd );

    return 0;
}

```



### –°–∫–∞—á–∏–≤–∞–Ω–∏–µ/–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤



–°–∫–∞—á–∏–≤–∞–Ω–∏–µ (–≤–∑–≥–ª—è–¥ —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã —Å–µ—Ä–≤–µ—Ä–∞)

```c
do {
    int c = remain_data > BUFSIZE ? BUFSIZE : remain_data;
    char *data = malloc(c);

    pread(fd, data, c, offset);
    offset += c;

    write(sock, data, c);
    free(data);
    remain_data -= c;

} while (remain_data > 0);
```

–ó–∞–≥—Ä—É–∑–∫–∞

```c
while (remain_data > 0) {
    int len = recv(sock, file_response, BUFSIZE, 0);
    fwrite(file_response, len, 1, fp);
    remain_data -= len;
    memset(file_response, 0, BUFSIZE);
}
```



–ù–∞ –∫–ª–∏–µ–Ω—Ç–µ –∏ —Å–µ—Ä–≤–µ—Ä–µ –º–µ—Ç–æ–¥—ã –∑–∞–≥—Ä—É–∑–∫–∏\—Å–∫–∞—á–∏–≤–∞–Ω–∏—è –¥–æ–≤–æ–ª—å–Ω–æ –ø–æ—Ö–æ–∂–∏.



### –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

–î–ª—è –Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤–∏–ª –ø—Ä–æ—Å—Ç–æ —É–ø—Ä–∞–≤–ª—è—é—â–∏–µ –ø—Ä–∏–≤—è–∑–∫–∏ –∫–ª–∞–≤–∏—à

```c
#define BACK_TO_HOME_LETTER 'H'
#define BACK_TO_HOME_LETTER_SPACED " H "

#define DOWNLOAD_LETTER 'D'
#define DOWNLOAD_LETTER_SPACED " D "

#define UPLOAD_LETTER 'U'
#define UPLOAD_LETTER_SPACED " U "

#define EXIT_LETTER 'Q'
#define EXIT_LETTER_SPACED " Q "

#define OPEN_LETTER 'O'
#define OPEN_LETTER_SPACED " O "

#define REFRESH_LETTER 'R'
#define REFRESH_LETTER_SPACED " R "

#define EXIT_VIEW_MODE_LETTER 'C'
#define EXIT_VIEW_MODE_LETTER_SPACED "C"

#define HELP_LETTER 'H'
#define HELP_LETTER_SPACED " H "
```



–ò –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∏—Ö

```c

if (c == KEY_UP) {
    if (pointer != 0) {
        cursor = 2;
        pointer--;
        up_down_event();
    }
}
if (c == KEY_DOWN) {
    if (pointer != files_count - 1) {
        cursor = 2;
        pointer++;
        up_down_event();
    }
}
if (c == 10) {
    old_pointer = pointer;
    File file = find_file_at(files, pointer)->file;
    on_select(file.name, strcmp(file.type, "DIR") != 0);
}
if (c == REFRESH_LETTER) {
    on_select(NULL, false);
}
if (c == HELP_LETTER) {
    on_select("", false);
}
if (c == DOWNLOAD_LETTER) {
    File file = list_at(files, pointer)->file;
    if (strcmp(file.type, "DIR") != 0) on_download(file.name);
}

```



–°–∞–º –∂–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–∏—à–µ–º –≤ –æ–±—ã—á–Ω–æ ncurses —Å—Ç–∏–ª–µ

```c
wattron(window_help, SELECTED);
wmove(window_help, 0, 1);
wprintw(window_help, EXIT_VIEW_MODE_LETTER_SPACED);

wmove(window_help, 1, 1);
wprintw(window_help, EXIT_LETTER_SPACED);

wattroff(window_help, SELECTED);

wmove(window_help, 0, 5);
wprintw(window_help, "Close file");
wmove(window_help, 1, 5);
wprintw(window_help, "Exit");
wmove(window_help, 0, 26);
wprintw(window_help, "Prev line");
wmove(window_help, 1, 26);
wprintw(window_help, "Next line");
```

–í—ã–≤–æ–¥ —Ñ–∞–π–ª–∏–∫–æ–≤

```c
wmove(window_main, cursor, 2);
wprintw(window_main, "%s", file->name);
if (strcmp(file->type, "FILE") == 0) {
    wmove(window_size, cursor, 3);
    wprintw(window_size, "%s", "F");
} else {
    wmove(window_size, cursor, 3);
    wprintw(window_size, "%s", "D");
}

wmove(window_date, cursor, 1);
wprintw(window_date, "%s", file->date);
```



–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ, —á—Ç–æ –ø—Ä–∏ –Ω–∞–ø–∏—Å–∞–Ω–∏–∏ –≤—Å–µ–≥–æ —ç—Ç–æ–≥–æ —è –≤—Å–ø–æ–º–Ω–∏–ª –ø—Ä–æ Java Swing (–Ω–µ –∑–Ω–∞—é –ø–æ—á–µ–º—É, –Ω–æ –Ω–∞–ø–æ–º–Ω–∏–ª–æ –ø—Ä–æ —ç—Ç–æ)



![image-20210614232423819](C:\Users\apploid\AppData\Roaming\Typora\typora-user-images\image-20210614232423819.png)



–°–æ–≥–ª–∞—Å–∏—Ç–µ—Å—å –≤—ã–≥–ª—è–¥–∏—Ç –∫—Ä–∞—Å–∏–≤–æ üòç





<p align='center'>
<img src='https://img.shields.io/badge/GitHub-100000?style=for-the-badge&logo=github&logoColor=white' />
</p>
